<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>XMPP | Uncontrolled Resource Consumption with Highly Compressed XMPP Stanzas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="/theme/images/xmpp-logo.png" />
  <link rel="stylesheet" href="/theme/css/app.css" type="text/css" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Exo+2:700,400|Merriweather:300italic,300,700" type="text/css" />
</head>
<body class="community/security-notices/" style="overflow-y: scroll;">
<nav class="top-bar" data-topbar role="navigation">
  <ul class="title-area">
    <li class="name">
      <h1>
        <a href="/"><img src="/theme/images/xmpp-logo.svg" style="display: inline-block; margin: -3px 5px 0 0; width: 30px; "/>XMPP</a>
      </h1>
    </li>
    <li class="toggle-topbar menu-icon">
      <a href="#"><span></span></a>
    </li>
  </ul>
  <section class="top-bar-section">
    <ul class="right">
      <li class="divider"></li>
      <li class="has-dropdown">
        <a href="/about">
          About
        </a>

        <ul class="dropdown">
          <li>
	    <a href="/about/history.html">
              History
            </a>
          </li>
          <li>
	    <a href="/about/technology-overview.html">
              Overview
            </a>
          </li>
          <li>
	    <a href="/about/who-uses-xmpp.html">
              Who uses XMPP
            </a>
          </li>
          <li>
	    <a href="/about/standards-process.html">
              Standards Process
            </a>
          </li>
          <li>
	    <a href="/about/xmpp-standards-foundation.html">
              The XSF
            </a>
          </li>
          <li>
	    <a href="/about/../extensions.html">
              Extensions
            </a>
          </li>
          <li>
	    <a href="/about/faq.html">
              FAQ
            </a>
          </li>
        </ul>
      </li>
      <li class="divider"></li>
      <li class="has-dropdown">
        <a href="/uses">
          Uses
        </a>

        <ul class="dropdown">
          <li>
	    <a href="/uses/instant-messaging.html">
              Instant Messaging
            </a>
          </li>
          <li>
	    <a href="/uses/internet-of-things.html">
              Internet of Things
            </a>
          </li>
          <li>
	    <a href="/uses/social.html">
              Social
            </a>
          </li>
          <li>
	    <a href="/uses/webrtc.html">
              WebRTC
            </a>
          </li>
        </ul>
      </li>
      <li class="divider"></li>
      <li class="has-dropdown">
        <a href="/software">
          Software
        </a>

        <ul class="dropdown">
          <li>
	    <a href="/software/clients.html">
              Clients
            </a>
          </li>
          <li>
	    <a href="/software/servers.html">
              Servers
            </a>
          </li>
          <li>
	    <a href="/software/libraries.html">
              Libraries
            </a>
          </li>
          <li>
	    <a href="/software/projects.html">
              Projects
            </a>
          </li>
        </ul>
      </li>
      <li class="divider"></li>
      <li class="active has-dropdown">
        <a href="/community">
          Community
        </a>

        <ul class="dropdown">
          <li>
	    <a href="/community/chat.html">
              Chat / logs
            </a>
          </li>
          <li>
	    <a href="/community/mailing-lists.html">
              Mailing lists
            </a>
          </li>
          <li>
	    <a href="/community/membership.html">
              Membership
            </a>
          </li>
          <li>
	    <a href="/community/events.html">
              Events
            </a>
          </li>
          <li>
	    <a href="/community/security-notices/">
              Security Notices
            </a>
          </li>
          <li>
	    <a href="/community/sponsors.html">
              Sponsors
            </a>
          </li>
        </ul>
      </li>
      <li class="divider"></li>
      <li
       >
        <a href="/blog.html">
          XMPP Blog
        </a>
      </li>
      <li class="divider"></li>
    </ul>
  </section>
</nav>
  <header class="header-internal">
    <h1>
      <a href="/community/security-notices/uncontrolled-resource-consumption-with-highly-compressed-xmpp-stanzas">
        Uncontrolled Resource Consumption with Highly Compressed XMPP Stanzas
      </a>
    </h1>
  </header>
        <div class="page-content row">
            <div class="large-8 large-push-1 medium-8 medium-push-1 columns">
              <article>
  <p><em>Original Release Date: 2014-04-04</em></p>
<p><em>Last Updated: 2014-04-15</em></p>
<h2>Overview</h2>
<p>Several XMPP server implementations that support application-layer compression (<a href="/extensions/xep-0138.html">XEP-0138</a>) suffer from an uncontrolled resource consumption vulnerability (<a href="https://cwe.mitre.org/data/definitions/400.html">CWE-400</a>). This vulnerability can be remotely exploited by attackers to mount Denial-of-Service attacks by sending highly-compressed XML elements over XMPP streams.</p>
<h2>Description</h2>
<p>XMPP stream compression is a desirable feature that reduces the amount of data transferred between the protocol principals. In XMPP, compression can be negotiated at the TLS layer (as described in <a href="/rfcs/rfc6120.html">RFC 6120</a>) or at the application layer (as described in <a href="/extensions/xep-0138.html">XEP-0138</a>). The vulnerability that has been discovered applies specifically to application-layer compression; such compression is negotiated between an XMPP client and server (or two servers) as follows:</p>
<ol>
<li>
<p>An XMPP server supporting application-layer compression advertises it in the stream feature message:</p>
<div class="highlight"><pre><span class="nt">&lt;stream:features&gt;</span>
  <span class="nt">&lt;starttls</span> <span class="na">xmlns=</span><span class="s">&#39;urn:ietf:params:xml:ns:xmpp-tls&#39;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;compression</span> <span class="na">xmlns=</span><span class="s">&#39;http://jabber.org/features/compress&#39;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;method&gt;</span>zlib<span class="nt">&lt;/method&gt;</span>
    <span class="nt">&lt;method&gt;</span>lzw<span class="nt">&lt;/method&gt;</span>
  <span class="nt">&lt;/compression&gt;</span>
<span class="nt">&lt;/stream:features&gt;</span>
</pre></div>


</li>
<li>
<p>The client selects one of the advertised compression algorithms:</p>
<div class="highlight"><pre><span class="nt">&lt;compress</span> <span class="na">xmlns=</span><span class="s">&#39;http://jabber.org/protocol/compress&#39;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;method&gt;</span>zlib<span class="nt">&lt;/method&gt;</span>
<span class="nt">&lt;/compress&gt;</span>
</pre></div>


</li>
<li>
<p>If no errors occur, the server agrees on the choice with the following message:</p>
<div class="highlight"><pre><span class="nt">&lt;compressed</span> <span class="na">xmlns=</span><span class="s">&#39;http://jabber.org/protocol/compress&#39;</span><span class="nt">/&gt;</span>
</pre></div>


</li>
</ol>
<p>After a successful negotiation, all the subsequent protocol messages are compressed.</p>
<p>When decompressing XMPP stanzas, an XMPP server must limit the resources
allocated to this task. If the server fails to do that, it can monopolize the
CPU usage and allocate all the available memory. As a result, remote attackers
can exploit this vulnerability to mount a Denial of Service attack (DoS) by
submitting highly-compressed XML elements over an XMPP stream (we call these
“xmppbombs” for short).</p>
<p>An "xmppbomb" is a valid XML element sent over an XML stream but containing a
huge number of white spaces. See for example the following element sent during
stream negotiation (e.g., on a stream restart after TLS negotiation):</p>
<div class="highlight"><pre><span class="cp">&lt;?xml version=&#39;1.0&#39; ?&gt;</span>
<span class="nt">&lt;stream:stream</span> <span class="err">$SPACES</span> <span class="na">to=</span><span class="s">&#39;$SERVER&#39;</span>
    <span class="na">xmlns=</span><span class="s">&#39;jabber:client&#39;</span>
    <span class="na">xmlns:stream=</span><span class="s">&#39;http://etherx.jabber.org/streams&#39;</span>
    <span class="na">version=</span><span class="s">&#39;1.0&#39;</span><span class="nt">&gt;</span>
</pre></div>


<p>where $SPACES is a 4GB long string of spaces and $SERVER is the server domain
name. By using the zlib compression algorithm, it is possible to compress the
above message to 4MB (compression ratio of ~1:1000).</p>
<p><a href="/extensions/xep-0170.html">XEP-0170</a> on "Recommended Order of
Stream Feature Negotiation" suggests to negotiate stream compression after the
authentication of the principals. This suggests that xmppbombs can be used only
after the user authentication. However, it has been reported that some
implementations allow the use of compression before the authentication phase
therefore opening up this vulnerability to unknown attackers.</p>
<h2>Impact</h2>
<p>Affected servers are reported to:</p>
<ol>
<li>Consume the virtual memory; in certain cases, it has been reported that servers are terminated by the operating system for out of memory conditions;</li>
<li>Monopolize the use of the CPU;</li>
<li>In certain cases, not allow administrators to disable stream compression.</li>
</ol>
<h2>Solution</h2>
<p>It is best to upgrade to corrected server code. An alternative, temporary workaround is to disable XMPP-level compression.</p>
<h2>Vendor Information</h2>
<p>The following table provides information about existing XMPP server implementations. To the best of our knowledge it is accurate and complete, but server administrators are advised to check with the developers of their preferred server software to verify the information provided here.</p>
<table>
<thead>
<tr>
<th>Vendor</th>
<th>Product</th>
<th>Status</th>
<th>Contacted</th>
<th>Updated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Apache</td>
<td>Vysper</td>
<td>Unknown</td>
<td>2014-03-12, &gt;2014-04-03</td>
<td>Unknown</td>
</tr>
<tr>
<td>Apple Inc.</td>
<td>iChat Server</td>
<td>Unaffected</td>
<td>2014-03-12</td>
<td>N/A</td>
</tr>
<tr>
<td>Cisco Systems, Inc.</td>
<td>Jabber XCP</td>
<td>Unaffected</td>
<td>2014-03-12</td>
<td>N/A</td>
</tr>
<tr>
<td>Citadel</td>
<td>Citadel</td>
<td>Unaffected</td>
<td>2014-03-12, 2014-04-03</td>
<td>N/A</td>
</tr>
<tr>
<td>CommuniGate</td>
<td>CommuniGate Pro</td>
<td>Unaffected</td>
<td>2014-03-12</td>
<td>N/A</td>
</tr>
<tr>
<td>Coversant</td>
<td>SoapBox Server</td>
<td>Unknown</td>
<td>2014-03-12, 2014-04-03</td>
<td>Unknown</td>
</tr>
<tr>
<td>djabberd</td>
<td>djabberd</td>
<td>Unknown</td>
<td>2014-03-12, 2014-04-03</td>
<td>Unknown</td>
</tr>
<tr>
<td>Erlang Solutions</td>
<td>MongooseIM</td>
<td>Fixed in 1.3.2</td>
<td>2014-04-03</td>
<td>2014-04-15</td>
</tr>
<tr>
<td>Google</td>
<td>Google Talk</td>
<td>Unknown</td>
<td>2014-03-12, 2014-04-03</td>
<td>Unknown</td>
</tr>
<tr>
<td>IBM</td>
<td>Lotus Sametime Gateway</td>
<td>Unaffected</td>
<td>2014-03-12, 2014-04-03</td>
<td>N/A</td>
</tr>
<tr>
<td>IceWarp</td>
<td>IceWarp Instant Messaging Server</td>
<td>Unknown</td>
<td>2014-03-12, 2014-04-03</td>
<td>Unknown</td>
</tr>
<tr>
<td>igniterealtime.org</td>
<td>Openfire</td>
<td>Fixed in 3.9.2</td>
<td>2014-03-12</td>
<td>2014-04-03</td>
</tr>
<tr>
<td>inetdextra</td>
<td>in.jabberd</td>
<td>Unknown</td>
<td>2014-03-12, 2014-04-03</td>
<td>Unknown</td>
</tr>
<tr>
<td>Isode Ltd.</td>
<td>M-Link</td>
<td>Fixed in 16.0v7</td>
<td>2014-03-12</td>
<td>2014-03-31</td>
</tr>
<tr>
<td>jabberd 1.x</td>
<td>jabberd 1.x</td>
<td>Unaffected</td>
<td>2014-03-12, 2014-04-03</td>
<td>N/A</td>
</tr>
<tr>
<td>jabberd 2.x</td>
<td>jabberd 2.x</td>
<td>Unaffected</td>
<td>2014-03-12</td>
<td>N/A</td>
</tr>
<tr>
<td>j-livesupport</td>
<td>Jerry Messenger</td>
<td>Unknown</td>
<td>2014-03-12, 2014-04-03</td>
<td>Unknown</td>
</tr>
<tr>
<td>Kwickserver</td>
<td>Kwickserver</td>
<td>Unaffected</td>
<td>2014-03-12, 2014-04-03</td>
<td>N/A</td>
</tr>
<tr>
<td>lightwitch.org</td>
<td>Metronome</td>
<td>Fix in progress</td>
<td>2014-04-03</td>
<td>TBD</td>
</tr>
<tr>
<td>ProcessOne</td>
<td>ejabberd</td>
<td>Unaffected</td>
<td>2014-03-12</td>
<td>N/A</td>
</tr>
<tr>
<td>Prosody</td>
<td>Prosody</td>
<td>Fixed in 0.9.4</td>
<td>2014-03-12</td>
<td>2014-04-02</td>
</tr>
<tr>
<td>psyced</td>
<td>psyced</td>
<td>Unaffected</td>
<td>2014-03-12, 2014-04-03</td>
<td>N/A</td>
</tr>
<tr>
<td>Siemens</td>
<td>Siemens OpenScape</td>
<td>Unaffected</td>
<td>2014-03-12, 2014-04-03</td>
<td>N/A</td>
</tr>
<tr>
<td>Tigase</td>
<td>Tigase</td>
<td>Fixed in 5.2.1</td>
<td>2014-03-12</td>
<td>2014-03-30</td>
</tr>
<tr>
<td>Vines</td>
<td>Vines</td>
<td>Unaffected</td>
<td>2014-03-12, 2014-04-03</td>
<td>N/A</td>
</tr>
<tr>
<td>Wokkel</td>
<td>Wokkel</td>
<td>Unknown</td>
<td>2014-03-12, 2014-04-03</td>
<td>Unknown</td>
</tr>
</tbody>
</table>
<p>Note: Although it is likely that a number of the servers with a status of “unknown” do not support XMPP-layer compression and therefore are not vulnerable to this uncontrolled resource consumption vulnerability, we have not heard from the developers of such servers and therefore cannot provide definitive information.</p>
<h2>References</h2>
<ul>
<li><a href="https://cwe.mitre.org/data/definitions/400.html">CWE-400: Uncontrolled Resource Consumption (‘Resource Exhaustion’)</a></li>
<li><a href="https://datatracker.ietf.org/doc/rfc6120/">RFC 6120: Extensible Messaging and Presence Protocol (XMPP): Core</a></li>
<li><a href="/extensions/xep-0138.html">XEP-0138: Stream Compression</a></li>
<li><a href="/extensions/xep-0170.html">XEP-0170: Recommended Order of Stream Feature Negotiation</a></li>
</ul>
<h2>Credits</h2>
<p>The vulnerability was reported by Giancarlo Pellegrino. This report was written by Giancarlo Pellegrino with assistance from Peter Saint-Andre.</p>
<h2>Feedback</h2>
<p>If you have feedback, comments, or additional information about this vulnerability, please send email to the <a href="http://mail.jabber.org/mailman/listinfo/security">security@xmpp.org discussion list</a>.</p>
              </article>
            </div>
            <div class="sidebar large-3 medium-3 columns">
       <h4>Community</h4>
       <ul>
          <li><a href="/community/chat.html">Chat / logs</a></li>
          <li><a href="/community/mailing-lists.html">Mailing lists</a></li>
          <li><a href="/community/membership.html">Membership</a></li>
          <li><a href="/community/events.html">Events</a></li>
          <li><a href="/community/security-notices/">Security Notices</a></li>
          <li><a href="/community/sponsors.html">Sponsors</a></li>
       </ul>
            </div>
        </div>

<div class="footer-sponsors">
  <h4>The XSF is generously sponsored by:</h4>
  <ul>
    <li><a href="/sponsors/coversant"><img src="/images/logos/coversant.png" alt="Coversant"></a></li>
    <li><a href="/sponsors/erlang-solutions"><img src="/images/logos/erlang-solutions.png" alt="Erlang Solutions"></a></li>
    <li><a href="/sponsors/eyeball-networks"><img src="/images/logos/eyeball-networks.png" alt="Eyeball Networks"></a></li>
    <li><a href="/sponsors/genesys-angel"><img src="/images/logos/genesys-angel.jpg" alt="Genesys | Angel"></a></li>
    <li><a href="/sponsors/kolon-benit"><img src="/images/logos/kolon-benit.png" alt="Kolon Benit"></a></li>
    <li><a href="/sponsors/processone"><img src="/images/logos/process-one.png" alt="ProcessOne"></a></li>
    <li><a href="/sponsors/us-secure-hosting-center"><img src="/images/logos/usshc.png" alt="US Secure Hosting Center"></a></li>
    <li><a href="/sponsors/voxeo"><img src="/images/logos/voxeo.gif" alt="Voxeo"></a></li>
  </ul>
</div>
<div class="footer-github">
  <p><a href="//github.com/xsf/xmpp.org"><img src="/theme/images/github.svg"></a>This site is organized in the open on GitHub. <a href="//github.com/xsf/xmpp.org">Suggest changes</a>.</p>
</div>
<footer class="top-bar">
  <section class="top-bar-section">
    <ul class="left">
      <li>
        <a href="/">
          Home
        </a>
      </li>
      <li>
        <a href="/about">
          About
        </a>
      </li>
      <li>
        <a href="/extensions">
          Extensions
        </a>
      </li>
      <li>
        <a href="/uses">
          Uses
        </a>
      </li>
      <li>
        <a href="/software">
          Software
        </a>
      </li>
      <li>
        <a href="/community">
          Community
        </a>
      </li>
    </ul>
    <ul class="right">
      <li>
        <a href="/blog.html">
          XMPP Blog
        </a>
      </li>
      <li>
        <a href="/contact">
          Contact
        </a>
      </li>
    </ul>
  </section>
</footer>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="/theme/js/foundation.js"></script>
  <script src="/theme/js/foundation.topbar.js"></script>
  <script>
    $(document).foundation();
  </script>

</body>
</html>